<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARENA MAXIMA â€” ç¾…é¦¬é¬¥ç¸å ´</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #d4a843;
    --gold-light: #f0c96a;
    --gold-dark: #8a6a1a;
    --blood: #8b1a1a;
    --blood-light: #cc2222;
    --stone: #2a2218;
    --stone-mid: #3d3525;
    --stone-light: #5a4f3a;
    --parchment: #e8d5a0;
    --sand: #c4a870;
    --white: #f5edd5;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: #1a140d;
    font-family: 'Crimson Text', serif;
    color: var(--parchment);
    min-height: 100vh;
    overflow-x: hidden;
    background-image:
      radial-gradient(ellipse at 50% 0%, rgba(212,168,67,0.08) 0%, transparent 60%),
      repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(0,0,0,0.15) 40px, rgba(0,0,0,0.15) 41px),
      repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(0,0,0,0.1) 40px, rgba(0,0,0,0.1) 41px);
  }

  /* ========== COLOSSEUM BACKDROP ========== */
  .colosseum-arch {
    position: fixed; top: 0; left: 0; right: 0;
    height: 100vh; pointer-events: none; z-index: 0;
    overflow: hidden;
  }
  .arch-pillar {
    position: absolute; bottom: 0; width: 60px;
    background: linear-gradient(to bottom, #3d3525 0%, #2a2218 100%);
    border-top: 4px solid var(--gold-dark);
    box-shadow: inset -5px 0 15px rgba(0,0,0,0.5), inset 5px 0 15px rgba(0,0,0,0.5);
  }
  .arch-pillar.left { left: 0; height: 85vh; }
  .arch-pillar.right { right: 0; height: 85vh; }
  .arch-pillar.left2 { left: 80px; height: 70vh; }
  .arch-pillar.right2 { right: 80px; height: 70vh; }

  /* ========== SCREENS ========== */
  .screen { display:none; position:relative; z-index:10; min-height:100vh; }
  .screen.active { display:flex; flex-direction:column; align-items:center; justify-content:center; }

  /* ========== INTRO SCREEN ========== */
  #screen-intro {
    padding: 40px 20px;
    background: 
      radial-gradient(ellipse at 50% 30%, rgba(139,26,26,0.25) 0%, transparent 60%),
      radial-gradient(ellipse at 50% 80%, rgba(212,168,67,0.1) 0%, transparent 50%);
  }

  .title-block { text-align: center; margin-bottom: 50px; }

  .title-latin {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(28px, 6vw, 72px);
    font-weight: 900;
    color: var(--gold);
    text-shadow: 0 0 40px rgba(212,168,67,0.6), 0 4px 8px rgba(0,0,0,0.8);
    letter-spacing: 0.1em;
    line-height: 1.1;
    animation: titleGlow 3s ease-in-out infinite alternate;
  }
  @keyframes titleGlow {
    from { text-shadow: 0 0 40px rgba(212,168,67,0.4), 0 4px 8px rgba(0,0,0,0.8); }
    to   { text-shadow: 0 0 80px rgba(212,168,67,0.9), 0 0 120px rgba(139,26,26,0.4), 0 4px 8px rgba(0,0,0,0.8); }
  }

  .title-sub {
    font-family: 'Cinzel', serif;
    font-size: clamp(12px, 2.5vw, 22px);
    color: var(--sand);
    letter-spacing: 0.4em;
    margin-top: 8px;
    opacity: 0.85;
  }

  .divider {
    display: flex; align-items: center; gap: 16px;
    margin: 20px auto; max-width: 500px;
  }
  .divider-line { flex:1; height:1px; background: linear-gradient(to right, transparent, var(--gold-dark), transparent); }
  .divider-icon { color: var(--gold); font-size: 18px; }

  /* ========== CHOICE PANELS ========== */
  .choice-section {
    width: 100%; max-width: 800px;
    margin-bottom: 32px;
  }

  .section-title {
    font-family: 'Cinzel', serif;
    font-size: 13px;
    letter-spacing: 0.4em;
    color: var(--gold-dark);
    text-transform: uppercase;
    text-align: center;
    margin-bottom: 16px;
  }

  .choice-grid {
    display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
  }

  .choice-card {
    background: linear-gradient(135deg, var(--stone-mid) 0%, var(--stone) 100%);
    border: 2px solid var(--stone-light);
    border-radius: 4px;
    padding: 18px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    min-width: 140px;
    position: relative;
    overflow: hidden;
  }
  .choice-card::before {
    content: '';
    position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(212,168,67,0.15) 0%, transparent 60%);
    opacity: 0; transition: opacity 0.3s;
  }
  .choice-card:hover::before, .choice-card.selected::before { opacity: 1; }
  .choice-card:hover {
    border-color: var(--gold-dark);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.5), 0 0 15px rgba(212,168,67,0.2);
  }
  .choice-card.selected {
    border-color: var(--gold);
    box-shadow: 0 0 25px rgba(212,168,67,0.4), inset 0 0 20px rgba(212,168,67,0.05);
  }

  .card-icon { font-size: 36px; margin-bottom: 8px; display: block; }
  .card-title {
    font-family: 'Cinzel', serif;
    font-size: 14px;
    font-weight: 700;
    color: var(--gold-light);
    margin-bottom: 4px;
  }
  .card-desc {
    font-size: 12px;
    color: var(--sand);
    opacity: 0.8;
    line-height: 1.4;
  }
  .card-stats {
    display: flex; gap: 8px; justify-content: center; margin-top: 8px;
  }
  .stat-badge {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 2px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--stone-light);
    color: var(--sand);
    font-family: 'Cinzel', serif;
  }

  /* ========== ENTER BUTTON ========== */
  .btn-enter {
    font-family: 'Cinzel Decorative', serif;
    font-size: 16px;
    letter-spacing: 0.2em;
    color: var(--stone);
    background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 50%, var(--gold-dark) 100%);
    border: none; border-radius: 3px;
    padding: 18px 50px;
    cursor: pointer;
    margin-top: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.3);
    position: relative;
    overflow: hidden;
  }
  .btn-enter::after {
    content: '';
    position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }
  .btn-enter:hover::after { left: 100%; }
  .btn-enter:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 30px rgba(0,0,0,0.7), 0 0 30px rgba(212,168,67,0.5);
  }
  .btn-enter:disabled {
    opacity: 0.4; cursor: not-allowed; transform: none;
  }

  /* ========== ARENA SCREEN ========== */
  #screen-arena {
    background:
      radial-gradient(ellipse at 50% 100%, rgba(139,100,30,0.2) 0%, transparent 50%),
      radial-gradient(ellipse at 50% 0%, rgba(139,26,26,0.15) 0%, transparent 50%);
    padding: 20px;
    align-items: stretch;
  }

  .arena-header {
    display: flex; align-items: center; justify-content: center;
    gap: 20px; padding: 10px; margin-bottom: 16px;
  }
  .arena-title {
    font-family: 'Cinzel', serif;
    font-size: 18px;
    letter-spacing: 0.3em;
    color: var(--gold);
    text-align: center;
  }

  /* ========== BATTLEFIELD ========== */
  .battlefield {
    display: flex;
    gap: 20px;
    align-items: stretch;
    margin-bottom: 16px;
    flex: 1;
  }

  /* ========== FIGHTER CARDS ========== */
  .fighter-side {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .fighter-card {
    background: linear-gradient(160deg, var(--stone-mid) 0%, var(--stone) 100%);
    border: 2px solid var(--stone-light);
    border-radius: 6px;
    padding: 16px;
    position: relative;
    transition: all 0.3s;
  }
  .fighter-card.player-card { border-color: var(--gold-dark); }
  .fighter-card.enemy-card { border-color: var(--blood); }
  .fighter-card.defeated {
    opacity: 0.4;
    filter: grayscale(1);
  }
  .fighter-card.shake {
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-8px) rotate(-1deg); }
    40% { transform: translateX(8px) rotate(1deg); }
    60% { transform: translateX(-5px); }
    80% { transform: translateX(5px); }
  }
  .fighter-card.attack-flash { animation: attackFlash 0.4s ease; }
  @keyframes attackFlash {
    0% { box-shadow: none; }
    50% { box-shadow: 0 0 30px rgba(212,168,67,0.8); }
    100% { box-shadow: none; }
  }

  .fighter-name {
    font-family: 'Cinzel', serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--gold-light);
    letter-spacing: 0.1em;
    margin-bottom: 6px;
  }
  .fighter-avatar {
    font-size: 48px;
    display: block;
    text-align: center;
    margin: 6px 0;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));
    transition: transform 0.2s;
  }

  /* HP Bar */
  .hp-container { margin-top: 8px; }
  .hp-label {
    font-family: 'Cinzel', serif;
    font-size: 10px;
    letter-spacing: 0.2em;
    color: var(--sand);
    display: flex; justify-content: space-between;
    margin-bottom: 4px;
  }
  .hp-bar-bg {
    background: rgba(0,0,0,0.5);
    border-radius: 2px; height: 10px;
    border: 1px solid rgba(255,255,255,0.1);
    overflow: hidden;
  }
  .hp-bar-fill {
    height: 100%; border-radius: 2px;
    transition: width 0.6s ease, background 0.6s ease;
    background: linear-gradient(to right, #2a8a2a, #44cc44);
  }
  .hp-bar-fill.warn { background: linear-gradient(to right, #8a7a00, #ccbb00); }
  .hp-bar-fill.crit { background: linear-gradient(to right, #8a2a00, #cc4400); }

  /* Status badges */
  .status-badges { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 6px; }
  .status-badge {
    font-size: 9px; font-family: 'Cinzel', serif;
    padding: 2px 5px; border-radius: 2px;
    letter-spacing: 0.1em;
  }
  .badge-defend { background: rgba(30,80,160,0.6); border: 1px solid #5588cc; color: #aac5ff; }
  .badge-stun   { background: rgba(120,0,120,0.6); border: 1px solid #cc55cc; color: #ffaaff; }

  /* ========== ARENA CENTER ========== */
  .arena-center {
    width: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  .vs-badge {
    font-family: 'Cinzel Decorative', serif;
    font-size: 20px;
    color: var(--blood-light);
    text-shadow: 0 0 20px rgba(139,26,26,0.8);
  }
  .round-badge {
    font-family: 'Cinzel', serif;
    font-size: 10px;
    letter-spacing: 0.2em;
    color: var(--gold-dark);
    text-align: center;
    writing-mode: vertical-lr;
    transform: rotate(180deg);
  }

  /* ========== DAMAGE FLOAT ========== */
  .damage-float {
    position: absolute;
    font-family: 'Cinzel Decorative', serif;
    font-size: 24px;
    font-weight: 900;
    pointer-events: none;
    animation: floatUp 1.2s ease forwards;
    z-index: 100;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9);
  }
  .damage-float.dmg-hit { color: #ff4444; }
  .damage-float.dmg-player { color: #ffaa00; }
  .damage-float.dmg-miss { color: #888; font-size: 16px; }
  .damage-float.dmg-crit { color: #ff0000; font-size: 32px; }
  .damage-float.dmg-heal { color: #44ff88; }
  @keyframes floatUp {
    0%   { opacity:1; transform: translateY(0) scale(1); }
    30%  { opacity:1; transform: translateY(-20px) scale(1.2); }
    100% { opacity:0; transform: translateY(-60px) scale(0.8); }
  }

  /* ========== COMBAT LOG ========== */
  .combat-log {
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--stone-light);
    border-radius: 4px;
    padding: 12px;
    height: 120px;
    overflow-y: auto;
    margin-bottom: 16px;
    font-size: 14px;
    line-height: 1.8;
  }
  .combat-log::-webkit-scrollbar { width: 4px; }
  .combat-log::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
  .combat-log::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 2px; }

  .log-entry {
    font-family: 'Crimson Text', serif;
    padding: 2px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    animation: logIn 0.3s ease;
  }
  @keyframes logIn { from { opacity:0; transform: translateX(-10px); } to { opacity:1; transform: translateX(0); } }
  .log-player  { color: var(--gold-light); }
  .log-enemy   { color: #ff8888; }
  .log-system  { color: var(--sand); font-style: italic; }
  .log-critical{ color: #ff4444; font-weight: 600; }

  /* ========== ACTION BUTTONS ========== */
  .action-bar {
    display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;
    margin-bottom: 10px;
  }

  .btn-action {
    font-family: 'Cinzel', serif;
    font-size: 12px;
    letter-spacing: 0.2em;
    border: 2px solid;
    border-radius: 3px;
    padding: 12px 20px;
    cursor: pointer;
    transition: all 0.25s ease;
    background: transparent;
    position: relative;
    overflow: hidden;
  }
  .btn-action::before {
    content: '';
    position: absolute; inset: 0;
    background: currentColor;
    opacity: 0;
    transition: opacity 0.25s;
  }
  .btn-action:hover::before { opacity: 0.15; }
  .btn-action:hover { transform: translateY(-2px); }
  .btn-action:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

  .btn-attack  { color: #ff8888; border-color: #882222; }
  .btn-heavy   { color: #ffaa44; border-color: #885500; }
  .btn-defend  { color: #88aaff; border-color: #224488; }
  .btn-special { color: #cc88ff; border-color: #662299; }

  .btn-action .btn-icon { font-size: 18px; display: block; margin-bottom: 2px; }
  .btn-action .btn-cost { font-size: 10px; opacity: 0.7; display: block; }

  /* ========== STAMINA ========== */
  .stamina-bar-area { text-align: center; margin-bottom: 8px; }
  .stamina-label {
    font-family: 'Cinzel', serif; font-size: 10px;
    letter-spacing: 0.2em; color: var(--gold-dark);
    margin-bottom: 4px;
  }
  .stamina-pips { display: flex; gap: 4px; justify-content: center; }
  .pip {
    width: 20px; height: 8px; border-radius: 2px;
    border: 1px solid var(--gold-dark);
    background: var(--gold);
    transition: all 0.3s;
  }
  .pip.empty { background: rgba(0,0,0,0.4); border-color: var(--stone-light); }

  /* ========== RESULT SCREEN ========== */
  #screen-result {
    text-align: center;
    padding: 40px;
  }
  .result-title {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(36px, 8vw, 80px);
    font-weight: 900;
    margin-bottom: 16px;
    animation: titleGlow 2s ease-in-out infinite alternate;
  }
  .result-title.victory { color: var(--gold); }
  .result-title.defeat  { color: var(--blood-light); }
  .result-desc {
    font-size: 20px; color: var(--sand); margin-bottom: 40px;
    font-style: italic; line-height: 1.6;
  }

  /* ========== TARGET SELECTOR ========== */
  .target-selector {
    display: flex; gap: 8px; justify-content: center;
    margin-bottom: 10px;
  }
  .btn-target {
    font-family: 'Cinzel', serif;
    font-size: 10px; letter-spacing: 0.1em;
    border: 1px solid var(--stone-light);
    border-radius: 2px;
    padding: 6px 12px;
    cursor: pointer;
    background: rgba(0,0,0,0.3);
    color: var(--sand);
    transition: all 0.2s;
  }
  .btn-target.active {
    border-color: var(--gold);
    color: var(--gold-light);
    background: rgba(212,168,67,0.1);
  }
  .btn-target:disabled { opacity: 0.3; cursor: not-allowed; }
  .target-label {
    font-family: 'Cinzel', serif;
    font-size: 10px; letter-spacing: 0.2em;
    color: var(--stone-light); text-align: center;
    margin-bottom: 6px;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
  ::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 3px; }

  /* ========== TURN INDICATOR ========== */
  .turn-indicator {
    font-family: 'Cinzel', serif;
    font-size: 11px; letter-spacing: 0.3em;
    text-align: center; margin-bottom: 8px;
    padding: 6px;
    border-radius: 3px;
    transition: all 0.3s;
  }
  .turn-player  { color: var(--gold); background: rgba(212,168,67,0.1); border: 1px solid var(--gold-dark); }
  .turn-enemy   { color: #ff8888; background: rgba(139,26,26,0.2); border: 1px solid var(--blood); }
  .turn-waiting { color: var(--sand); background: rgba(0,0,0,0.2); border: 1px solid var(--stone-light); }

</style>
</head>
<body>

<!-- Colosseum backdrop pillars -->
<div class="colosseum-arch">
  <div class="arch-pillar left"></div>
  <div class="arch-pillar right"></div>
  <div class="arch-pillar left2"></div>
  <div class="arch-pillar right2"></div>
</div>

<!-- ==================== INTRO SCREEN ==================== -->
<div id="screen-intro" class="screen active">
  <div class="title-block">
    <div class="title-latin">ARENA MAXIMA</div>
    <div class="title-sub">ç¾…é¦¬é¬¥ç¸å ´ Â· COLOSSEUM</div>
  </div>

  <div class="divider">
    <div class="divider-line"></div>
    <div class="divider-icon">âš”</div>
    <div class="divider-line"></div>
  </div>

  <!-- MODE SELECTION -->
  <div class="choice-section">
    <div class="section-title">âš” é¸æ“‡æˆ°é¬¥æ¨¡å¼ MODUS PUGNAE</div>
    <div class="choice-grid" id="mode-grid">
      <div class="choice-card" data-mode="1v1" onclick="selectMode(this)">
        <span class="card-icon">ğŸ—¡ï¸</span>
        <div class="card-title">ä¸€å°ä¸€</div>
        <div class="card-desc">å–®æŒ‘è§’é¬¥å£«<br>1v1 Gladiator</div>
      </div>
      <div class="choice-card" data-mode="1v2" onclick="selectMode(this)">
        <span class="card-icon">âš”ï¸</span>
        <div class="card-title">ä¸€å°äºŒ</div>
        <div class="card-desc">å°æŠ—å…©ä½è§’é¬¥å£«<br>1v2 Gladiators</div>
      </div>
      <div class="choice-card" data-mode="1v3" onclick="selectMode(this)">
        <span class="card-icon">ğŸ›¡ï¸</span>
        <div class="card-title">ä¸€å°ä¸‰</div>
        <div class="card-desc">ä»¥ä¸€æ•µä¸‰å‹‡è€…<br>1v3 Gladiators</div>
      </div>
      <div class="choice-card" data-mode="beast1" onclick="selectMode(this)">
        <span class="card-icon">ğŸ¦</span>
        <div class="card-title">å°æˆ°é‡ç¸</div>
        <div class="card-desc">é¢å°ä¸€é ­çŒ›ç¸<br>1v1 Beast</div>
      </div>
      <div class="choice-card" data-mode="beast2" onclick="selectMode(this)">
        <span class="card-icon">ğŸ»</span>
        <div class="card-title">é›™ç¸åŒå ´</div>
        <div class="card-desc">å°æˆ°å…©é ­é‡ç¸<br>1v2 Beasts</div>
      </div>
    </div>
  </div>

  <div class="divider">
    <div class="divider-line"></div>
    <div class="divider-icon">ğŸ›¡</div>
    <div class="divider-line"></div>
  </div>

  <!-- WEAPON SELECTION -->
  <div class="choice-section">
    <div class="section-title">âš” é¸æ“‡æ­¦å™¨ ARMA</div>
    <div class="choice-grid" id="weapon-grid">
      <div class="choice-card" data-weapon="sword" onclick="selectWeapon(this)">
        <span class="card-icon">ğŸ—¡ï¸</span>
        <div class="card-title">åŠ GLADIUS</div>
        <div class="card-desc">å‡è¡¡ä¹‹å™¨<br>æ”»å®ˆå…¼å‚™</div>
        <div class="card-stats">
          <span class="stat-badge">âš” å‚·15-25</span>
          <span class="stat-badge">ğŸ›¡ é–ƒ20%</span>
        </div>
      </div>
      <div class="choice-card" data-weapon="spear" onclick="selectWeapon(this)">
        <span class="card-icon">ğŸ”±</span>
        <div class="card-title">æ§ HASTA</div>
        <div class="card-desc">é«˜å‚·é ç¨‹<br>å‘½ä¸­ç‡è¼ƒä½</div>
        <div class="card-stats">
          <span class="stat-badge">âš” å‚·20-40</span>
          <span class="stat-badge">ğŸ¯ æº–75%</span>
        </div>
      </div>
      <div class="choice-card" data-weapon="axe" onclick="selectWeapon(this)">
        <span class="card-icon">ğŸª“</span>
        <div class="card-title">æ–§é ­ SECURIS</div>
        <div class="card-desc">æœ€é«˜å‚·å®³<br>æœ‰æ©Ÿæœƒçˆ†æ“Š</div>
        <div class="card-stats">
          <span class="stat-badge">âš” å‚·25-45</span>
          <span class="stat-badge">ğŸ’¥ çˆ†25%</span>
        </div>
      </div>
    </div>
  </div>

  <button class="btn-enter" id="btn-start" onclick="startGame()" disabled>
    âš” é€²å…¥ç«¶æŠ€å ´ INTRA ARENAM âš”
  </button>
</div>

<!-- ==================== ARENA SCREEN ==================== -->
<div id="screen-arena" class="screen">
  <div class="arena-header">
    <div class="arena-title" id="arena-title">ARENA MAXIMA</div>
  </div>

  <div class="battlefield" id="battlefield">
    <!-- Player side -->
    <div class="fighter-side" id="player-side">
      <div class="fighter-card player-card" id="player-card">
        <div class="fighter-name" id="player-name">å‹‡å£« GLADIATOR</div>
        <span class="fighter-avatar" id="player-avatar">âš”ï¸</span>
        <div class="hp-container">
          <div class="hp-label">
            <span>HP</span>
            <span id="player-hp-text">100/100</span>
          </div>
          <div class="hp-bar-bg">
            <div class="hp-bar-fill" id="player-hp-bar" style="width:100%"></div>
          </div>
        </div>
        <div class="status-badges" id="player-status"></div>
      </div>
    </div>

    <!-- Center -->
    <div class="arena-center">
      <div class="vs-badge">VS</div>
      <div class="round-badge" id="round-display">ROUND I</div>
    </div>

    <!-- Enemy side -->
    <div class="fighter-side" id="enemy-side">
      <!-- dynamically generated -->
    </div>
  </div>

  <!-- Target selector (for multi-enemy) -->
  <div id="target-area" style="display:none">
    <div class="target-label">é¸æ“‡æ”»æ“Šç›®æ¨™ TARGET</div>
    <div class="target-selector" id="target-buttons"></div>
  </div>

  <!-- Turn indicator -->
  <div class="turn-indicator turn-waiting" id="turn-indicator">æº–å‚™æˆ°é¬¥...</div>

  <!-- Stamina -->
  <div class="stamina-bar-area">
    <div class="stamina-label">âš¡ é«”åŠ› STAMINA</div>
    <div class="stamina-pips" id="stamina-pips"></div>
  </div>

  <!-- Action buttons -->
  <div class="action-bar" id="action-bar">
    <button class="btn-action btn-attack" onclick="playerAction('normal')">
      <span class="btn-icon">âš”</span>
      æ™®é€šæ”»æ“Š
      <span class="btn-cost">æ¶ˆè€— 1 é«”åŠ›</span>
    </button>
    <button class="btn-action btn-heavy" onclick="playerAction('heavy')">
      <span class="btn-icon">ğŸ’¥</span>
      é‡æ“Š
      <span class="btn-cost">æ¶ˆè€— 2 é«”åŠ›</span>
    </button>
    <button class="btn-action btn-defend" onclick="playerAction('defend')">
      <span class="btn-icon">ğŸ›¡</span>
      é˜²å®ˆ
      <span class="btn-cost">æ¶ˆè€— 0 é«”åŠ›</span>
    </button>
    <button class="btn-action btn-special" onclick="playerAction('special')">
      <span class="btn-icon">âœ¨</span>
      å¿…æ®º
      <span class="btn-cost">æ¶ˆè€— 3 é«”åŠ›</span>
    </button>
  </div>

  <!-- Combat log -->
  <div class="combat-log" id="combat-log">
    <div class="log-entry log-system">âš” é¬¥ç¸å ´çš„å¤§é–€ç·©ç·©é–‹å•Ÿ... è§€çœ¾å¸­çˆ†ç™¼å‡ºéœ‡å¤©æ€’å¼ï¼</div>
  </div>
</div>

<!-- ==================== RESULT SCREEN ==================== -->
<div id="screen-result" class="screen">
  <div class="result-title" id="result-title">VICTORIA!</div>
  <div class="result-desc" id="result-desc"></div>
  <button class="btn-enter" onclick="resetGame()">âš” å†æˆ°ä¸€å ´ ITERUM âš”</button>
</div>

<script>
// ==================== GAME STATE ====================
const WEAPONS = {
  sword: {
    name: 'åŠ GLADIUS', icon: 'ğŸ—¡ï¸',
    minDmg: 15, maxDmg: 25, critChance: 0.10,
    accuracy: 0.90, dodgeBonus: 0.20,
    heavyMult: 1.8, specialDesc: 'æ—‹é¢¨æ–¬'
  },
  spear: {
    name: 'æ§ HASTA', icon: 'ğŸ”±',
    minDmg: 20, maxDmg: 40, critChance: 0.08,
    accuracy: 0.75, dodgeBonus: 0.08,
    heavyMult: 2.0, specialDesc: 'è²«ç©¿åˆº'
  },
  axe: {
    name: 'æ–§é ­ SECURIS', icon: 'ğŸª“',
    minDmg: 25, maxDmg: 45, critChance: 0.25,
    accuracy: 0.80, dodgeBonus: 0.05,
    heavyMult: 2.2, specialDesc: 'å¤©å´©æ–¬'
  }
};

const MODES = {
  '1v1':   { enemies: [{ name:'è§’é¬¥å£« MURMILLO', icon:'ğŸ›¡ï¸', hp:90,  atk:[10,20], dodge:0.12 }] },
  '1v2':   { enemies: [
               { name:'è§’é¬¥å£« RETIARIUS', icon:'ğŸª¬', hp:75, atk:[8,18], dodge:0.15 },
               { name:'è§’é¬¥å£« THRAEX',   icon:'ğŸ—¡ï¸', hp:75, atk:[10,20], dodge:0.12 }
             ]},
  '1v3':   { enemies: [
               { name:'è§’é¬¥å£« I', icon:'ğŸ›¡ï¸', hp:65, atk:[8,16], dodge:0.10 },
               { name:'è§’é¬¥å£« II', icon:'âš”ï¸', hp:65, atk:[8,16], dodge:0.10 },
               { name:'è§’é¬¥å£« III', icon:'ğŸ—¡ï¸', hp:65, atk:[8,16], dodge:0.10 }
             ]},
  'beast1': { enemies: [{ name:'é›„ç… LEO', icon:'ğŸ¦', hp:110, atk:[15,28], dodge:0.18 }] },
  'beast2': { enemies: [
               { name:'é›„ç… LEO', icon:'ğŸ¦', hp:90, atk:[14,26], dodge:0.18 },
               { name:'æ£•ç†Š URSA', icon:'ğŸ»', hp:95, atk:[15,28], dodge:0.08 }
             ]}
};

let gameState = {
  mode: null, weapon: null,
  player: null, enemies: [],
  turn: 'player', round: 1,
  stamina: 5, maxStamina: 5,
  isAnimating: false,
  targetIndex: 0,
  playerDefending: false
};

// ==================== INTRO ====================
function selectMode(card) {
  document.querySelectorAll('#mode-grid .choice-card').forEach(c => c.classList.remove('selected'));
  card.classList.add('selected');
  gameState.mode = card.dataset.mode;
  checkStartReady();
}

function selectWeapon(card) {
  document.querySelectorAll('#weapon-grid .choice-card').forEach(c => c.classList.remove('selected'));
  card.classList.add('selected');
  gameState.weapon = card.dataset.weapon;
  checkStartReady();
}

function checkStartReady() {
  document.getElementById('btn-start').disabled = !(gameState.mode && gameState.weapon);
}

// ==================== START GAME ====================
function startGame() {
  const w = WEAPONS[gameState.weapon];
  const m = MODES[gameState.mode];

  gameState.player = {
    name: `å‹‡å£« ${w.name.split(' ')[1] || ''}`,
    icon: w.icon,
    hp: 100, maxHp: 100,
    weapon: gameState.weapon,
    defending: false
  };

  gameState.enemies = m.enemies.map(e => ({
    ...e, maxHp: e.hp, alive: true, defending: false
  }));

  gameState.turn = 'player';
  gameState.round = 1;
  gameState.stamina = 5;
  gameState.targetIndex = 0;
  gameState.playerDefending = false;

  buildArena();
  showScreen('arena');
  updateAll();
  addLog('âš” æˆ°é¬¥é–‹å§‹ï¼è§€çœ¾çš„æ­¡å‘¼éŸ¿å¾¹é›²éœ„ï¼', 'system');
}

// ==================== BUILD ARENA UI ====================
function buildArena() {
  const w = WEAPONS[gameState.weapon];

  // Player card
  document.getElementById('player-name').textContent = `${w.icon} å‹‡å£«`;
  document.getElementById('player-avatar').textContent = w.icon;

  // Enemy cards
  const enemySide = document.getElementById('enemy-side');
  enemySide.innerHTML = '';
  gameState.enemies.forEach((e, i) => {
    enemySide.innerHTML += `
      <div class="fighter-card enemy-card" id="enemy-card-${i}">
        <div class="fighter-name">${e.icon} ${e.name}</div>
        <span class="fighter-avatar" id="enemy-avatar-${i}">${e.icon}</span>
        <div class="hp-container">
          <div class="hp-label">
            <span>HP</span><span id="enemy-hp-text-${i}">${e.hp}/${e.maxHp}</span>
          </div>
          <div class="hp-bar-bg">
            <div class="hp-bar-fill" id="enemy-hp-bar-${i}" style="width:100%"></div>
          </div>
        </div>
        <div class="status-badges" id="enemy-status-${i}"></div>
      </div>`;
  });

  // Target buttons (multi-enemy)
  const targetArea = document.getElementById('target-area');
  const targetBtns = document.getElementById('target-buttons');
  targetBtns.innerHTML = '';
  if (gameState.enemies.length > 1) {
    gameState.enemies.forEach((e, i) => {
      targetBtns.innerHTML += `<button class="btn-target ${i===0?'active':''}" id="target-btn-${i}" onclick="setTarget(${i})">${e.icon} ${e.name.split(' ')[0]}</button>`;
    });
    targetArea.style.display = 'block';
  } else {
    targetArea.style.display = 'none';
  }

  // Stamina pips
  buildStaminaPips();
  document.getElementById('arena-title').textContent =
    `COLOSSEUM Â· ${gameState.mode.includes('beast') ? 'å‹‡å£« vs é‡ç¸' : 'è§’é¬¥å£«ç«¶æŠ€'}`;
}

function buildStaminaPips() {
  const container = document.getElementById('stamina-pips');
  container.innerHTML = '';
  for (let i = 0; i < gameState.maxStamina; i++) {
    container.innerHTML += `<div class="pip ${i < gameState.stamina ? '' : 'empty'}" id="pip-${i}"></div>`;
  }
}

function setTarget(i) {
  if (gameState.enemies[i] && gameState.enemies[i].alive) {
    gameState.targetIndex = i;
    document.querySelectorAll('.btn-target').forEach((b,j) => {
      b.classList.toggle('active', j===i);
    });
  }
}

// ==================== UPDATE UI ====================
function updateAll() {
  updatePlayerUI();
  updateEnemiesUI();
  updateStamina();
  updateRound();
  updateTurnIndicator();
  updateTargetButtons();
  updateActionButtons();
}

function updatePlayerUI() {
  const p = gameState.player;
  const pct = p.hp / p.maxHp * 100;
  const bar = document.getElementById('player-hp-bar');
  bar.style.width = Math.max(0, pct) + '%';
  bar.className = 'hp-bar-fill' + (pct < 25 ? ' crit' : pct < 50 ? ' warn' : '');
  document.getElementById('player-hp-text').textContent = `${Math.max(0,p.hp)}/${p.maxHp}`;

  const status = document.getElementById('player-status');
  status.innerHTML = p.defending ? '<span class="status-badge badge-defend">ğŸ›¡ é˜²å®ˆä¸­</span>' : '';
}

function updateEnemiesUI() {
  gameState.enemies.forEach((e, i) => {
    const pct = e.hp / e.maxHp * 100;
    const bar = document.getElementById(`enemy-hp-bar-${i}`);
    if (!bar) return;
    bar.style.width = Math.max(0, pct) + '%';
    bar.className = 'hp-bar-fill' + (pct < 25 ? ' crit' : pct < 50 ? ' warn' : '');
    document.getElementById(`enemy-hp-text-${i}`).textContent = `${Math.max(0,e.hp)}/${e.maxHp}`;

    const card = document.getElementById(`enemy-card-${i}`);
    if (!e.alive && card && !card.classList.contains('defeated')) {
      card.classList.add('defeated');
    }
    const status = document.getElementById(`enemy-status-${i}`);
    if (status) status.innerHTML = e.defending ? '<span class="status-badge badge-defend">ğŸ›¡ é˜²å®ˆ</span>' : '';
  });
}

function updateStamina() {
  for (let i = 0; i < gameState.maxStamina; i++) {
    const pip = document.getElementById(`pip-${i}`);
    if (pip) pip.className = 'pip' + (i < gameState.stamina ? '' : ' empty');
  }
}

function updateRound() {
  const romans = ['I','II','III','IV','V','VI','VII','VIII','IX','X'];
  document.getElementById('round-display').textContent =
    'ROUND ' + (romans[gameState.round - 1] || gameState.round);
}

function updateTurnIndicator() {
  const el = document.getElementById('turn-indicator');
  if (gameState.turn === 'player') {
    el.className = 'turn-indicator turn-player';
    el.textContent = 'âš” ä½ çš„å›åˆ YOUR TURN';
  } else {
    el.className = 'turn-indicator turn-enemy';
    el.textContent = 'âš¡ æ•µæ–¹æ”»æ“Šä¸­... ENEMY TURN';
  }
}

function updateTargetButtons() {
  gameState.enemies.forEach((e, i) => {
    const btn = document.getElementById(`target-btn-${i}`);
    if (btn) btn.disabled = !e.alive;
  });
  // Auto-select first alive target
  const alive = gameState.enemies.findIndex(e => e.alive);
  if (alive >= 0 && !gameState.enemies[gameState.targetIndex]?.alive) {
    setTarget(alive);
  }
}

function updateActionButtons() {
  const disabled = gameState.turn !== 'player' || gameState.isAnimating;
  const stamina = gameState.stamina;
  const btns = document.querySelectorAll('.btn-action');
  btns.forEach(b => b.disabled = disabled);
  if (!disabled) {
    document.querySelector('.btn-attack').disabled = stamina < 1;
    document.querySelector('.btn-heavy').disabled = stamina < 2;
    document.querySelector('.btn-special').disabled = stamina < 3;
  }
}

// ==================== COMBAT ACTIONS ====================
function playerAction(type) {
  if (gameState.turn !== 'player' || gameState.isAnimating) return;
  const w = WEAPONS[gameState.weapon];
  let damage = 0, staminaCost = 0, hit = true;

  gameState.player.defending = false;

  if (type === 'defend') {
    gameState.player.defending = true;
    addLog(`ğŸ›¡ <b>ä½ </b>æ¡å–é˜²å®ˆå§¿æ…‹ï¼Œæº–å‚™æ ¼æ“‹æ•µæ–¹æ”»æ“Šï¼`, 'player');
    updatePlayerUI();
    endPlayerTurn();
    return;
  }

  if (type === 'normal') {
    staminaCost = 1;
    hit = Math.random() < w.accuracy;
    if (hit) {
      damage = randInt(w.minDmg, w.maxDmg);
      let crit = Math.random() < w.critChance;
      if (crit) { damage = Math.floor(damage * 2); }
      const logClass = crit ? 'critical' : 'player';
      addLog(`${crit ? 'ğŸ’¥ çˆ†æ“Šï¼' : 'âš”'} <b>ä½ </b>æ®${weaponVerb()}ï¼Œé€ æˆ <b>${damage}</b> é»å‚·å®³${crit ? 'ï¼ã€CRITICAL!ã€‘' : ''}`, crit ? 'critical' : 'player');
    } else {
      addLog(`ğŸ’¨ <b>ä½ </b>å‡ºæ“Šï¼Œä½†æ•µæ–¹é–ƒé¿äº†ï¼`, 'player');
    }
  } else if (type === 'heavy') {
    staminaCost = 2;
    hit = Math.random() < (w.accuracy * 0.85);
    if (hit) {
      damage = Math.floor(randInt(w.minDmg, w.maxDmg) * w.heavyMult);
      addLog(`ğŸ”¥ <b>ä½ </b>ä½¿å‡ºé‡æ“Šï¼Œé€ æˆ <b>${damage}</b> é»æ²‰é‡å‚·å®³ï¼`, 'player');
    } else {
      addLog(`ğŸ’¨ <b>ä½ </b>é‡æ“Šè½ç©ºï¼`, 'player');
    }
  } else if (type === 'special') {
    staminaCost = 3;
    damage = Math.floor(randInt(w.minDmg, w.maxDmg) * 2.8);
    addLog(`âœ¨ <b>ä½ </b>æ–½å±•ã€${w.specialDesc}ã€‘ï¼Œé€ æˆæ¯€æ»…æ€§ <b>${damage}</b> é»å‚·å®³ï¼`, 'critical');
  }

  gameState.stamina = Math.max(0, gameState.stamina - staminaCost);

  if (hit && damage > 0) {
    const target = gameState.enemies[gameState.targetIndex];
    if (target && target.alive) {
      // Check enemy defending
      if (target.defending) {
        damage = Math.floor(damage * 0.4);
        addLog(`ğŸ›¡ æ•µæ–¹æ ¼æ“‹ï¼å‚·å®³æ¸›è‡³ <b>${damage}</b>ï¼`, 'system');
        target.defending = false;
      }
      applyDamageToEnemy(gameState.targetIndex, damage, type === 'special');
    }
  } else if (!hit) {
    showDamageFloat(document.getElementById(`enemy-card-${gameState.targetIndex}`), 'MISS', 'dmg-miss');
  }

  updateAll();
  checkWin();
  if (!isGameOver()) {
    endPlayerTurn();
  }
}

function applyDamageToEnemy(index, damage, special = false) {
  const e = gameState.enemies[index];
  if (!e || !e.alive) return;
  e.hp -= damage;

  // Shake & flash
  const card = document.getElementById(`enemy-card-${index}`);
  if (card) {
    card.classList.add('shake');
    setTimeout(() => card.classList.remove('shake'), 400);
  }
  const playerCard = document.getElementById('player-card');
  if (playerCard) {
    playerCard.classList.add('attack-flash');
    setTimeout(() => playerCard.classList.remove('attack-flash'), 400);
  }

  showDamageFloat(card, `-${damage}`, special ? 'dmg-crit' : 'dmg-hit');

  if (e.hp <= 0) {
    e.hp = 0;
    e.alive = false;
    addLog(`ğŸ’€ ${e.icon} <b>${e.name}</b> å€’ä¸‹äº†ï¼è§€çœ¾æ²¸é¨°ï¼`, 'system');
    updateEnemiesUI();
  }
}

function endPlayerTurn() {
  gameState.turn = 'enemy';
  updateTurnIndicator();
  updateActionButtons();

  setTimeout(() => {
    enemyTurn();
  }, 1000);
}

// ==================== ENEMY TURN ====================
function enemyTurn() {
  gameState.isAnimating = true;
  const alive = gameState.enemies.filter(e => e.alive);
  if (alive.length === 0) { endRound(); return; }

  let delay = 0;
  alive.forEach((e, seq) => {
    setTimeout(() => {
      if (gameState.player.hp <= 0) return;

      // Enemy AI: 15% chance to defend
      if (Math.random() < 0.15) {
        e.defending = true;
        addLog(`ğŸ›¡ ${e.icon} <b>${e.name}</b> é€²å…¥é˜²å®ˆå§¿æ…‹ï¼`, 'enemy');
        updateEnemiesUI();
        return;
      }

      e.defending = false;
      const hit = Math.random() > (gameState.player.defending ? 0.5 : 0.2);
      if (!hit) {
        addLog(`ğŸ’¨ ${e.icon} <b>${e.name}</b> æ”»æ“Šï¼Œä½†è¢«ä½ é–ƒé¿äº†ï¼`, 'enemy');
        showDamageFloat(document.getElementById('player-card'), 'DODGE', 'dmg-miss');
        return;
      }

      let dmg = randInt(e.atk[0], e.atk[1]);
      if (gameState.player.defending) {
        dmg = Math.floor(dmg * 0.35);
        addLog(`ğŸ›¡ <b>ä½ </b>æˆåŠŸæ ¼æ“‹ï¼åªå—åˆ° <b>${dmg}</b> é»å‚·å®³ï¼`, 'player');
      } else {
        const crit = Math.random() < 0.08;
        if (crit) { dmg = Math.floor(dmg * 1.8); }
        addLog(`${crit ? 'ğŸ’¥ çˆ†æ“Šï¼' : 'âš¡'} ${e.icon} <b>${e.name}</b>æ”»æ“Šä½ ï¼Œé€ æˆ <b>${dmg}</b> é»å‚·å®³${crit ? 'ï¼' : ''}`, crit ? 'critical' : 'enemy');
      }

      gameState.player.hp -= dmg;

      const playerCard = document.getElementById('player-card');
      if (playerCard) {
        playerCard.classList.add('shake');
        setTimeout(() => playerCard.classList.remove('shake'), 400);
      }
      showDamageFloat(playerCard, `-${dmg}`, 'dmg-player');
      updatePlayerUI();

    }, delay);
    delay += 1200;
  });

  setTimeout(() => {
    gameState.player.defending = false;
    updatePlayerUI();
    gameState.isAnimating = false;

    if (checkWin()) return;
    startNewRound();
  }, delay + 200);
}

// ==================== ROUND MANAGEMENT ====================
function startNewRound() {
  gameState.round++;
  gameState.turn = 'player';

  // Recover 2 stamina per round, max 5
  gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 2);

  addLog(`â”€â”€â”€â”€â”€â”€â”€ ç¬¬ ${gameState.round} å›åˆé–‹å§‹ ROUND ${gameState.round} â”€â”€â”€â”€â”€â”€â”€`, 'system');
  updateAll();
}

function endRound() {
  gameState.isAnimating = false;
  checkWin();
}

// ==================== WIN/LOSE CHECK ====================
function checkWin() {
  const allDead = gameState.enemies.every(e => !e.alive);
  if (allDead) {
    setTimeout(() => showVictory(), 800);
    return true;
  }
  if (gameState.player.hp <= 0) {
    gameState.player.hp = 0;
    updatePlayerUI();
    setTimeout(() => showDefeat(), 800);
    return true;
  }
  return false;
}

function isGameOver() {
  return gameState.player.hp <= 0 || gameState.enemies.every(e => !e.alive);
}

function showVictory() {
  document.getElementById('result-title').textContent = 'VICTORIA!';
  document.getElementById('result-title').className = 'result-title victory';
  document.getElementById('result-desc').innerHTML =
    `ä½ åœ¨ ${gameState.round} å›åˆå…§æ“Šæ•—äº†æ‰€æœ‰æ•µäººï¼<br>è§€çœ¾é«˜å‘¼ä½ çš„åå­—ï¼Œé®®èŠ±èˆ‡æ£•æ¢ è‘‰å¾å¤©è€Œé™ï¼<br><i>"Hic vir fortissimus est!"</i>`;
  showScreen('result');
}

function showDefeat() {
  document.getElementById('result-title').textContent = 'DAMNATIO';
  document.getElementById('result-title').className = 'result-title defeat';
  document.getElementById('result-desc').innerHTML =
    `ä½ åœ¨ç¬¬ ${gameState.round} å›åˆå€’ä¸‹äº†ã€‚<br>ä½†ä½ çš„å‹‡æ°£å°‡è¢«ç¾…é¦¬äººéŠ˜è¨˜æ–¼å¿ƒï¼<br><i>"Morituri te salutant!"</i>`;
  showScreen('result');
}

// ==================== HELPERS ====================
function randInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function weaponVerb() {
  const verbs = { sword:'åŠ', spear:'æ§', axe:'æ–§' };
  return verbs[gameState.weapon] || 'æ­¦å™¨';
}

function addLog(msg, type = 'system') {
  const log = document.getElementById('combat-log');
  const entry = document.createElement('div');
  entry.className = `log-entry log-${type}`;
  entry.innerHTML = msg;
  log.appendChild(entry);
  log.scrollTop = log.scrollHeight;
}

function showDamageFloat(card, text, cls) {
  if (!card) return;
  const el = document.createElement('div');
  el.className = `damage-float ${cls}`;
  el.textContent = text;
  el.style.left = (30 + Math.random() * 40) + '%';
  el.style.top = (20 + Math.random() * 30) + '%';
  card.style.position = 'relative';
  card.appendChild(el);
  setTimeout(() => el.remove(), 1200);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(`screen-${id}`).classList.add('active');
}

function resetGame() {
  gameState = {
    mode: null, weapon: null,
    player: null, enemies: [],
    turn: 'player', round: 1,
    stamina: 5, maxStamina: 5,
    isAnimating: false,
    targetIndex: 0,
    playerDefending: false
  };
  document.querySelectorAll('.choice-card').forEach(c => c.classList.remove('selected'));
  document.getElementById('btn-start').disabled = true;
  document.getElementById('combat-log').innerHTML =
    '<div class="log-entry log-system">âš” é¬¥ç¸å ´çš„å¤§é–€ç·©ç·©é–‹å•Ÿ... è§€çœ¾å¸­çˆ†ç™¼å‡ºéœ‡å¤©æ€’å¼ï¼</div>';
  showScreen('intro');
}
</script>
</body>
</html>
